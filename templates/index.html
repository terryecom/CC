<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Terry Ecom Link Checker</title>
    <meta name="viewport" content="width=900, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        #logArea {
            height: 340px;
            resize: none;
            font-family: monospace;
            font-size: 14px;
        }
        .contact-btns button {
            min-width: 130px;
        }
        #domainInfoPanel {
            min-width: 260px;
            max-width: 340px;
        }
        @media (max-width: 900px) {
            #domainInfoPanel { max-width: 100%; min-width: 0; margin-top: 2rem;}
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-4">
    <h2 class="mb-3">Terry Ecom Link Checker</h2>
    <div class="row gx-5">
        <!-- Left: Crawl/search/results -->
        <div class="col-lg-8 col-12">
            <div class="mb-3 row">
                <label for="urlInput" class="col-sm-2 col-form-label">Website URL:</label>
                <div class="col-sm-10">
                    <input type="text" id="urlInput" class="form-control" placeholder="https://yourshopifystore.com">
                </div>
            </div>
            <div class="mb-3">
                <button id="startBtn" class="btn btn-success me-2">Start Crawl</button>
                <button id="cancelBtn" class="btn btn-danger me-2">Cancel</button>
                <button id="exportBtn" class="btn btn-primary">Export Results</button>
            </div>
            <div class="mb-3">
                <textarea id="logArea" class="form-control" readonly></textarea>
            </div>
            <div class="mb-3">
                <div class="progress" style="height: 26px;">
                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width:0%">0%</div>
                </div>
            </div>
            <div class="mb-3">
                <span id="statusLabel">Pages Scanned: 0</span>
            </div>
            <div class="mb-3 contact-btns d-flex flex-wrap gap-2">
                <button onclick="window.open('https://www.terryecom.com','_blank')" class="btn btn-secondary">üåê Website</button>
                <button onclick="window.open('mailto:terry@terryecom.com','_blank')" class="btn btn-secondary">‚úâÔ∏è Email</button>
                <button onclick="window.open('https://www.instagram.com/terryecom/','_blank')" class="btn btn-secondary">üì∑ Instagram</button>
                <button onclick="window.open('https://x.com/TerryEcom','_blank')" class="btn btn-secondary">ùïè Twitter</button>
            </div>
        </div>
        <!-- Right: Domain Info Panel -->
        <div class="col-lg-4 col-12 mt-lg-0 mt-4">
            <div id="domainInfoPanel" class="card shadow" style="display:none;">
                <div class="card-header bg-secondary text-white">
                    <strong>Domain Info</strong>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li><strong>Domain:</strong> <span id="domainInfoDomain"></span></li>
                        <li><strong>Created:</strong> <span id="domainInfoCreated"></span></li>
                        <li><strong>Registrar:</strong> <span id="domainInfoRegistrar"></span></li>
                    </ul>
                </div>
            </div>
            <!-- Error box (domain does not exist) -->
            <div id="domainInfoErrorBox" class="alert alert-danger py-2 px-3 mt-4" style="display:none">
                <span id="domainInfoErrorText"></span>
            </div>
        </div>
    </div>
</div>
<script>
    let crawlInterval = null;
    let lastDomainInfo = {};

    function updateLogs(logs) {
        let logArea = document.getElementById("logArea");
        logArea.value = logs.join('\n');
        logArea.scrollTop = logArea.scrollHeight;
    }

    function updateProgress(progress) {
        let bar = document.getElementById("progressBar");
        bar.style.width = progress + "%";
        bar.innerText = progress + "%";
    }

    function updateStatus(pages) {
        document.getElementById("statusLabel").innerText = "Pages Scanned: " + pages;
    }

    function showDomainInfo(domain, created, registrar) {
        document.getElementById("domainInfoDomain").innerText = domain || '';
        document.getElementById("domainInfoCreated").innerText = created || 'Unknown';
        document.getElementById("domainInfoRegistrar").innerText = registrar || 'Unknown';
        document.getElementById("domainInfoPanel").style.display = '';
        document.getElementById("domainInfoErrorBox").style.display = 'none';
    }

    function showDomainError(msg) {
        document.getElementById("domainInfoPanel").style.display = 'none';
        document.getElementById("domainInfoErrorText").innerText = msg;
        document.getElementById("domainInfoErrorBox").style.display = '';
    }

    function pollProgress() {
        fetch('/progress').then(r=>r.json()).then(data=>{
            updateLogs(data.logs);
            updateProgress(data.progress);
            updateStatus(data.pages_scanned);
            let info = data.domain_info || {};
            if (info.created || info.registrar || info.domain) {
                // Show right-panel info
                showDomainInfo(info.domain || lastDomainInfo.domain, info.created, info.registrar);
                lastDomainInfo = {...lastDomainInfo, ...info};
            }
            if(data.finished) {
                clearInterval(crawlInterval);
                crawlInterval = null;
                document.getElementById("startBtn").disabled = false;
                document.getElementById("cancelBtn").disabled = true;
